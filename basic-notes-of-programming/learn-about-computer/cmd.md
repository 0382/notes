# 【编程基础知识（三）】 命令行

第三个软件，中文名叫做命令提示符，英文名叫做`cmd`。首先试着搜索打开这个软件吧。

## 命令提示符

打开这个软件，你会发现进入一个黑框框、一些字符、以及一个光标等着你输入，看上去像是电影里面黑客用的东西。

> 我想黑客大约确实会经常使用类似的软件，不过这并不是什么很神奇的东西，你也能很轻松学会使用这个软件。

在图形化界面出现之前，我们只能通过这样的字符界面来控制计算机。那时候没有鼠标点击动作，没有精致的各种图标，你只能对着这样的黑框框通过键盘来操作计算机。操作计算机的基本步骤就是：输入一条命令，即是对计算机发出一个指令，计算机发生对应的动作，并将结果通过字符的形式打印在这个字符界面上。

这个字符界面，我们称之为命令行。Windows上的这个命令行，和你连到服务器上的那个命令行有所不同，但是基本作用是相同的。所以何不在windows上先体会和学习一下。

命令行，一般来说有两个功能，**运行程序**和作为某种**系统脚本语言的解释器**。

### 切换文件夹

在解释着两个功能之前，我先熟悉一下命令行的基本操作。

你会看到光标前面有一个文件夹路径，`cmd`打开时的默认路径就是你的个人账户目录，或者说`HOME`目录。现在输入`dir`三个字母并回车，你会看到下面打印出当前目录下的所有子目录和文件。输入`cd Desktop`回车，可以进入当前文件夹的`Desktop`子目录。如果电脑有多个磁盘分区，可以使用`D:`回车进入`D`盘。

以前没有界面的电脑，我们只能通过这样的命令行界面游走于系统文件树，进入不同的文件夹做不同的事情。

命令行中的几个特殊文件夹名
- `.`（英文句号），表示当前目录
- `..`（两个英文句号），表示上一级目录。你可以使用`cd ..`返回上一级目录。
- `/`，对于linux来说是根目录，对于Windows来说是某个盘符下的根目录。
- `~`，`HOME`目录。不过这个特殊目录名在`cmd`中并不支持。

#### 相对路径和绝对路径

当你在`HOME`目录下时，当前目录下存在一个`Desktop`目录，于是你可以`cd Desktop`进入该目录。这里`Desktop`是一个相对路径，相对当前的`HOME`目录的路径。如果你不在`HOME`目录下，依然输入`cd Desktop`回车，则会提示`系统找不到指定的路径。`

但是如果你输入`cd C:/User/你的账号/Desktop`，则只要你在`C:`盘内，你就可以直接进到`Desktop`。这里使用的就是绝对路径。

绝对路径很好理解，将所有的上级目录写全就好了。对于相对路径，你还可以使用`..`来构造复杂的相对路径，比如如果你在`Desktop`目录里面，可以使用`cd ../Downloads`进入下载目录。`..`也可以嵌套使用。

> 作业：试着在`cmd`中使用`cd`命令进入不同的目录，使用`dir`命令查看其下的文件，然后看看文件资源管理器中对应的目录。自行练习一下相对目录和绝对目录的使用。

> 现在Windows大部分程序都支持使用`/`来作为文件夹分隔符，以前只能用`\`来分隔，造成很多人都习惯使用`\`。但是linux下只支持`/`。为了在各个系统下行为一致，还是建议统一使用`/`吧。不过`cmd`中有的时候是不支持`/`的。

### 运行程序

在某个目录下，输入`notepad hello.txt`，即会用记事本打开一个`hello.txt`文件，如果当前目录没有这个文件就会新建一个。这是使用`cmd`运行程序的一个示例，你还可以试着运行一些系统内置的程序比如`explorer, mspaint, taskmgr, winver`等等，看看打开的是什么。

命令行运行程序，一般来说说支持程序的运行

1. 在系统指定的目录内的。比如上述提到的系统内置软件。
2. 通过手动指定相对路径或者绝对路径。

#### a. 系统指定目录

`cmd`中可以打开很多系统内置程序，是因为这些程序是放在`C:/Windows`或者`C:/Windows/System32`，而这个文件夹都是系统指定的目录。在这两个目录下的程序，只要输入程序的名字就能够直接打开。

> 你可以打开这两个文件夹找找看`explorer.exe`, `notepad.exe`, `cmd.exe`程序等等。注意千万不要删除其中的文件。

这个系统指定目录，是存在一个叫做`PATH`的环境变量之中。这里不解释什么是环境变量，仅仅介绍一下`PATH`变量的相关知识。`win+q`搜索`path`打开系统环境变量编辑程序，点击环境变量，在系统变量栏双击`PATH`行，可以添加或者删除路径。你在这里看到的路径，其中包含的程序都可以在`cmd`中直接打开。

> 比你装`python`时，有一个`add xxx to PATH`选项，就是将你的python安装目录添加到`PATH`变量之中，使得你可以随意打开`python`程序。如果你忘了点击这个选项，也可以按照上述方式添加`python.exe`所在目录到`PATH`。然后重启`cmd`，输入`python`回车，也可以直接运行`python`。

#### b. 手动指定路径

如果你的`python`所在目录没有添加到`PATH`中，你可以通过指定绝对路径的方式运行，比如`C:/xxx/Python37/python.exe`。

当然你可以进入到安装目录`C:/xxx/Python37`中，然后使用`./python.exe`相对路径运行这个程序。

一般我们自己开发一个程序，为了测试总是要运行一下。但是这不适合添加到系统的`PATH`中，就可以使用绝对路径或者相对路径来运行这个程序。

#### c. `cmd`中的注意事项

另外有一些`cmd`下需要注意的特殊规则。

- `cmd`运行程序的时候，不支持`/`的分隔符，所以请改成`.\python.exe`等写法。
- `cmd`中可以省略`.\`。比如你装了百度网盘，进入其安装目录`C:/path-to/BaiduNetdisk`，直接输入`Baidunetdisk.exe`就可以运行程序了。
- `cmd`中可以省略`.exe`。所以上面的例子也可以直接使用`Baidunetdisk`。

### 批处理(batch)--Windows内置的脚本语言

命令行的另外一个作用是作为系统脚本语言的解释器。

> 实际上在Windows中，`cd`命令和`dir`命令都不是程序，而是批处理脚本语言的一部分。但是在linux中，`cd`是shell脚本的一部分，但是`dir`则是一个程序。

`batch`脚本是windows下的系统脚本语言。它太古老了，没有什么学习的必要。不过可以简单了解一下，知道其作用就好了。

在`cmd`中输入`echo hello world`回车，你就完成了最简单的`batch`编程。输入`echo %PATH%`，看看输出的是什么，体会一下`PATH`变量这个称呼的意义。再试着输入`for /L %i in (1,1,10) do echo %i`，以及`for /D %d in (*) do echo %d`，看看结果。可以看到批处理脚本的功能还是挺丰富的。

既然是脚本编程语言，当然也可以写成脚本文件运行。`batch`脚本的文件拓展名是`.bat`或者`.cmd`。你可以试着将上述的命令写成脚本文件试着运行一下。比如写一个`hello.cmd`文件
```batch
for /L %%i in (1,2,10) do explorer
pause
```
进入该文件所在目录，输入`hello`回车试一试吧。在文件资源管理器中再使用鼠标双击一下该文件，看看会发生什么。

上述脚本文件中，`explorer`并不是一个脚本语句，而是一个程序名字，但是它可以很自由的放进`batch`脚本之中。这是这类脚本语言的特点，将脚本与程序结合起来，从而完成某些自动化操作程序的目的。

如果对批处理感兴趣可以去学一学。我觉得没有学习的必要，我写本文时用到的这些批处理脚本命令，都是临时查的。只要知道，`.bat`文件和`.cmd`文件是批处理脚本，可以双击运行就好了。（当然看到类似文件也不要随便双击，万一是个病毒呢）。

## 命令行参数

无论是脚本语言的命令，还是命令行运行的程序，通常都可以带参数。比如`cd Desktop`这个命令，`cd`是`batch`脚本命令，`Desktop`这是其参数。`dir`命令也可以带参数，比如`dir C:\Windows`，此时就不是现实当前目录的文件夹和文件，而是那个参数所指定的文件夹。

命令行参数也可以不只一个，比如如下`git`程序的一条命令
```bash
git commit -m "Update Readme.md`
```
`git`是自己安装的程序`git.exe`，后面有三个参数，如果参数带空格，需要用引号包裹起来。

### 程序接受命令行参数

你自己写的程序也可以接受命令行参数。下面是c语言接受命令行参数的例子，命令行参数会以字符串的形式传给`main`函数，你可以按自己喜欢的方式处理
```c
#include <stdio.h>

int main(int argc, char const *argv[])
{
    for(int i=0; i<argc; ++i)
    {
        printf("%dth: %s\n", i, argv[i]);
    }
    return 0;
}
```
其他语言接受命令行参数的做法大同小异，可以自行了解。

### 命令行参数的一些约定

命令行参数传给`main`函数之后，你想怎么处理都行，但是大家有一些通用的约定

- 帮助参数，可能有`-h`, `--help`, `-?`, `/?`等等。Windows下`/?`的风格偏多，linux下通常是`-h`以及`--help`。比如可以使用`dir /?`命令看看`dir`命令是如何使用的。`git`最早是linux下的程序，你可以使用`git --help`查看其帮助信息。
- 版本信息，一般是`-v`或者`--version`。比如查看`gcc`编译器版本`gcc -v`，查看`python`版本`python --version`。

## 总结

本文主要介绍了`cmd`的基本使用。命令行最重要的还是要练习，因为难点不是命令行本身，而是各种可以在命令行运行的程序。这些程序可能是系统内置的，也可能是你自己安装的，并且都有很多不同的参数，要熟练掌握是需要时间的。

最后提一下，现在大家的电脑都有图形界面，那么要使用命令行实际上是通过一个字符界面模拟软件来实现的，我们统称这个界面程序为终端(`terminal`)、或控制台(`console`)。而这个界面程序里面运行的脚本解释器，实际是另外一个程序，在linux上就是各种`shell`程序，最常用的是`bash`。`cmd`或许也可以称为一种`shell`。

打开`cmd`出现的这个默认终端太难看了，你可以试着换成微软自己开发的[windows terminal](https://docs.microsoft.com/en-us/windows/terminal/)。此外，`cmd`太古老了，所以微软也开发了一个Windows下的`shell`程序[Powershell](https://docs.microsoft.com/zh-cn/powershell/scripting/overview?view=powershell-7.1)，一般系统应该都内置了，你可以搜索打开试试看。